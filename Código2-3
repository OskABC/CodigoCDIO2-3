#include <Adafruit_ADS1X15.h>

#define channelValue 0
#define offset 1.16
#define samplingInterval 20
#define printInterval 800
#define ArrayLength 40
int pHArray [ArrayLength];
int pHArrayIndex = 0;

int resultado = 0;

Adafruit_ADS1X15 ads1115; 


void setup() {
  Serial.begin(9600);
  Serial.println("Inicializamos el sensor de pH");

  ads1115.begin(0x48);
  ads1115.setGain(GAIN_ONE);
}



int averageSample(int *p, int tam){
  int media = 0;
  for(int i=0; i < tam; i++){
    media = media + p[i];
  }
  media = media/tam;
  return media;
}


void loop() {
  static unsigned long samplingTime = millis();
  static unsigned long printTime = millis();
  static float pHValue, voltage;
  if (millis() - samplingTime > samplingInterval){

    int16_t adc = ads1115.readADC_SingleEnded(0);
    pHArray[pHArrayIndex++] = adc;

    //Serial.println();Serial.println(adc);Serial.println();
    
    if(pHArrayIndex == ArrayLength)pHArrayIndex = 0;

      averageSample(pHArray, ArrayLength);
      voltage = adc * 4.096/32767;
      pHValue = 3.5 * voltage + offset; 
      samplingTime = millis();
  }
  if(millis() - printTime > printInterval){
    Serial.print("Voltage: ");
    Serial.print(voltage, 2);
    Serial.print("    pHValue: ");
    Serial.println(pHValue, 2);
    Serial.println();
    
    
  }

}
